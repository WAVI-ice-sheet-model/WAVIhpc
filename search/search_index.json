{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"WAVIhpc","text":"<p>A configuration and helper repository to assist with running WAVI ensembles locally or on HPCs using model-ensembler.</p>"},{"location":"#supported-platforms","title":"Supported Platforms","text":"<p>Currently WAVIhpc supports execution in single mode and ensemble mode on the following platforms:</p> <ul> <li>Locally</li> <li>BAS HPC</li> <li>ARCHER2.</li> <li>JASMIN.</li> </ul>"},{"location":"#installation-and-usage","title":"Installation and Usage","text":"<p>Because installation instructions differ slightly between platforms, please refer to the installation instructions in our documentation.</p>"},{"location":"#functionality","title":"Functionality","text":"<p>WAVIhpc provides convenience function to help set up and run WAVI ensembles:</p> <ul> <li><code>wavi_install</code>: Installs WAVI into a Julia environment.</li> <li><code>wavi_create_case</code>: Creates a new ensembling case based on a provided template.</li> <li><code>wavi_ensemble</code>: Runs a WAVI ensemble.</li> <li><code>wavi_execute</code>: Runs a single execution of WAVI (ie not an ensemble).</li> </ul>"},{"location":"#templates-and-use-cases","title":"Templates and Use Cases","text":"<p>WAVIhpc also provides generic templates and specific cases you can base your ensembles on:</p> <ul> <li><code>template</code>: a generic boilerplate template.</li> <li><code>template_archer</code>: a template set up to run ensembles on ARCHER2.</li> <li><code>template_bas</code>: a template set up to run ensembles on the BAS HPC.</li> <li><code>template_jasmin</code>: a template set up to run ensembles on JASMIN.</li> <li><code>ATTR_666</code>:</li> <li><code>MISMIP_666</code>: Marine Ice Sheet Model Intercomparison Project (MISMIP).</li> <li><code>MISOMIP_666</code>: Marine Ice Sheet-Ocean Model Intercomparison Project (MISOMIP).</li> </ul>"},{"location":"#authors-and-acknowledgement","title":"Authors and Acknowledgement","text":"<p>This repository was created by Alex Bradley.</p> <p>It has also been developed and maintained by James Byrne and Thomas Zwagerman.</p> <p></p>"},{"location":"#license","title":"License","text":"<p>MIT</p>"},{"location":"acknowledgement/","title":"Acknowledgement","text":"<p>This repository was created by:</p> <ul> <li>Alex Bradley (@alextbradley)</li> </ul> <p>It has also received contributions, and is being maintained by:</p> <ul> <li>James Byrne (@JimCircadian)</li> <li>Thomas Zwagerman (@thomaszwagerman)</li> </ul>"},{"location":"advanced_usage/","title":"Advanced Usage","text":"<p>A collection of more advanced use cases and how to approach them.</p>"},{"location":"advanced_usage/#using-different-pkg-environments-for-different-experimentsruns","title":"Using different Pkg environments for different experiments/runs","text":"<p>By default activity will take place in a default <code>wavi_test</code> Pkg environment.</p> <p>You can set <code>WAVI_ENV</code> to create / use different environments for different experiments / runs!</p> <p>For example: <pre><code>export WAVI_ENV=\"mismip_run\"\n</code></pre></p> <p>Please read here for more information about Julia environments.</p>"},{"location":"advanced_usage/#pulling-code-from-a-template-to-existing-case-directory","title":"Pulling code from a template to existing case directory","text":"<p>First, check the differences between the original template (<code>template_bas/</code>) and your current case directory (<code>anewcase/</code>):</p> <pre><code>diff --brief --recursive cases/template_bas/ cases/anewcase/\n</code></pre> <p>This will show you files you have updated in your case directory, since copying them over from the template.</p> <p>You can partially rsync these files to only transfer updates.</p> <p>For example, if we had changed <code>template_bas/code/myfunction.jl</code>, and wanted to move this  change to <code>anewcase/code/myfunction.jl</code>:</p> <pre><code>rsync --inplace --no-whole-file cases/template_bas/code/myfunction.jl cases/anewcase/code/myfunction.jl\n</code></pre> <p>This should update <code>myfunction.jl</code> in <code>anewcase</code> with changes made in <code>template_bas/code/myfunction.jl</code>.</p> <p>Overwriting existing destination file</p> <p>Take some care with the approach, this will overwrite any changes you have made to <code>cases/anewcase/code/myfunction.jl</code> that do not appear in <code>template_bas/code/myfunction.jl</code>.</p>"},{"location":"functionality/","title":"Functionality","text":""},{"location":"functionality/#wavi_install","title":"<code>wavi_install</code>","text":"<p>Installs WAVI into a Julia Pkg Environment.</p> <pre><code>wavi_install\n</code></pre> <p><code>wavi_install</code> can also accept an additional <code>--develop &lt;path&gt;</code> argument to specify a local clone of WAVI to install from:</p> <pre><code>wavi_install --develop ~/Documents/WAVI\n</code></pre>"},{"location":"functionality/#wavi_create_case","title":"<code>wavi_create_case</code>","text":"<p>Creates a new case by copying an existing template:</p> <pre><code># Usage\nwavi_create_case &lt;name-of-new-case&gt; &lt;source-template&gt;\n\n# Example\nwavi_create_case anewcase bas_template\n</code></pre> <p>Where the first argument is the name of the new case, and the second the existing template to copy from.</p>"},{"location":"functionality/#wavi_ensemble","title":"<code>wavi_ensemble</code>","text":"<p>Sets up the Python environment, installs model-ensembler and calls <code>model_ensemble</code> using the configuration <code>.yml</code> provided:</p> <pre><code># Usage\nwavi_ensemble &lt;ensemble-name&gt; &lt;case-template&gt;\n\n# Example\nwavi_ensemble test_ensemble anewcase\n</code></pre> <p>Where the first argument is a name you want to give your ensemble, and the second argument is the cases folder you have configured it in.</p>"},{"location":"functionality/#wavi_execute","title":"<code>wavi_execute</code>","text":"<p>Provides a single execution command for WAVI:</p> <pre><code># Usage\nwavi_execute &lt;run-name&gt; &lt;pkg-environment&gt;\n\n# Example\nwavi_execute test_run wavi_test\n</code></pre> <p>Where the first argument is a name you want to give to the run, and the second argument it the Pkg environment you have installed WAVI in.</p>"},{"location":"installation/","title":"Getting Started","text":""},{"location":"installation/#pre-requisites","title":"Pre-requisites","text":"<p>It is recommended you have some familiarity of how to use:</p> <ul> <li>WAVI.</li> <li>model-ensembler.</li> <li>Running SLURM jobs on your chosen platform (BAS HPC (internal), JASMIN LOTUS, ARCHER2).</li> </ul>"},{"location":"installation/#platform-specific-setup","title":"Platform-specific setup","text":"<p>Setup and installation instructions are provided for each platform:</p> <ol> <li>ARCHER2</li> <li>JASMIN</li> <li>BAS HPC</li> <li>Local</li> </ol> <p>After directory setup and Julia installation, all platforms follow common instructions.</p>"},{"location":"installation/#archer2jasmin","title":"ARCHER2/JASMIN","text":""},{"location":"installation/#directory-setup","title":"Directory setup","text":"<p>Make sure the functions in <code>scripts</code> can be found:</p> <pre><code>cd &lt;directoryOfRepo&gt;\n\n# For ARCHER2\nexport PATH=\"`realpath .`/scripts/archer:$PATH\"\n\n# For JASMIN\nexport PATH=\"`realpath .`/scripts/jasmin:$PATH\"\n</code></pre>"},{"location":"installation/#julia-installation","title":"Julia Installation","text":"<p>There are no Julia modules on JASMIN/ARCHER2, but you can conveniently install Julia using <code>juliaup</code>:</p> <pre><code>curl -fsSL https://install.julialang.org | sh\n</code></pre> <p>This will automatically set up Julia for you - there are no additional steps needed as the installation will be visible to the HPC nodes by default.</p> <p>You can now continue setting up using the all platform instructions below.</p>"},{"location":"installation/#bas-hpc","title":"BAS HPC","text":""},{"location":"installation/#directory-setup_1","title":"Directory setup","text":"<p>Depending on the default shell you wish to use (bash or c shell), instructions differ slightly:</p> bashc shell <p>Firstly, set <code>JULIA_DEPOT_PATH</code> for package storage in <code>~/.bashrc</code>:</p> <pre><code>export JULIA_DEPOT_PATH=\"/data/hpcdata/users/$USER/.julia:$JULIA_DEPOT_PATH\"\n</code></pre> <p>Then, make sure the functions in <code>scripts</code> can be found:</p> <pre><code>cd &lt;directoryOfRepo&gt;\nexport PATH=\"`realpath .`/scripts/BAS:$PATH\"\n</code></pre> <p>Remember to run <code>source ~/.bashrc</code>.</p> <p>Firstly, set <code>JULIA_DEPOT_PATH</code> for package storage in <code>~/.cshrc</code>:</p> <pre><code>setenv JULIA_DEPOT_PATH=\"/data/hpcdata/users/$USER/.julia\"\n</code></pre> <p>Then, make sure the functions in <code>scripts</code> can be found:</p> <pre><code>cd &lt;directoryOfRepo&gt;\nsetenv PATH=\"`realpath .`/scripts/BAS\"\n</code></pre> <p>Remember to run <code>source ~/.cshrc</code>.</p>"},{"location":"installation/#julia-installation_1","title":"Julia Installation","text":"<p>This is where Julia packages will be installed. It is recommended the location is visible to the workstations (ie. under \"/data\"), and in an area specific to you as user.</p> <p>To install/load Julia, you have a few options:</p> <ol> <li>Using juliaup (recommended): <pre><code>curl -fsSL https://install.julialang.org | sh\n</code></pre> Choose <code>custom installation</code>, and make sure juliaup is installed in the following location: <code>/data/hpcdata/users/&lt;USER&gt;/.juliaup</code>. All other settings can be set as their default.</li> <li>Load the Julia module that is available on the HPC: <pre><code>module avail julia\nmodule load julia-*\n</code></pre> Note that the availability of modules on the BAS HPC is subject to change.</li> <li>Install Julia manually, and provided Julia's location is set in PATH, using the provided <code>install_julia.sh</code> script: <pre><code>cd &lt;directoryOfRepo&gt;\n\ninstall_julia.sh\n</code></pre></li> </ol> <p>Where is Julia?</p> <p>Just installing Julia using <code>juliaup</code> would be the easiest thing to do. Unfortunately at present, whether this works out of the box or not depends entirely on which node you are attempting to run Julia on.</p> <p>This is because some nodes (currently the Centos based ones) configure <code>$HOME</code> to <code>/users/&lt;USER&gt;</code>, rather than <code>/data/hpcdata/users/&lt;USER&gt;</code>, even though this is not a visible directory for the node.</p> <p>Therefore, if <code>$HOME</code> changes between the workstation you submit from (e.g. <code>/users/&lt;USER&gt;</code>) and the node you submit to (e.g. <code>/data/hpcdata/users/&lt;USER&gt;</code>) <code>juliaup</code> will break. Currently, the combination of <code>install_julia.sh</code> and the scripts submitted to SLURM in <code>template_bas/</code> set <code>$HOME</code> manually for you.</p> <p>While using a Rocky workstation (e.g. <code>bsl-ws-s10</code>) and submitting to the Rocky partition, <code>juliaup</code> can be used for Julia installation, and will run on the node without issues.</p> <p>In the (near) future, all workstations and nodes will be Rocky based, and these instructions can be simplified.</p> <p>You should now be able to call the convenvience functions under <code>/scripts</code>, such as <code>wavi_install</code>.</p> <p>You can now continue setting up using the all platform instructions below.</p>"},{"location":"installation/#local","title":"Local","text":"<p>As with ARCHER2/JASMIN, you can install Julia using <code>juliaup</code>.</p> <p>Then just point to the scripts under <code>local</code> so they can be found:</p> <pre><code>cd &lt;directoryOfRepo&gt;\nexport PATH=\"`realpath .`/scripts/local:$PATH\"\n</code></pre> <p>You can now continue setting up using the all platform instructions below.</p>"},{"location":"installation/#all-platforms","title":"All Platforms","text":"<p>Check Julia is installed:</p> <pre><code>julia --version\n</code></pre> <p>To install WAVI:</p> <pre><code>wavi_install\n</code></pre> <p>This will install WAVI.</p>"},{"location":"installation/#development-branches","title":"Development Branches","text":""},{"location":"installation/#local-branch","title":"Local branch","text":"<p><code>wavi_install</code> can accept an additional <code>--develop &lt;path&gt;</code> argument to specify your local clone of WAVI to install from.</p> <pre><code>wavi_install --develop /data/hpcdata/users/&lt;USER&gt;/WAVI\n</code></pre>"},{"location":"installation/#remote-branch","title":"Remote branch","text":"<p>If you want to install a remote branch of the WAVI repository, you can do so with the following commands:</p> <p><pre><code>export WAVI_REPO=\"https://github.com/RJArthern/WAVI.jl\"\nexport WAVI_REV=\"branch-name\"\n</code></pre> Then call <code>wavi_install</code> as normal.</p> <p>Pkg environments</p> <p>WAVI will automatically be installed into an Pkg enviroment called <code>wavi_test</code>. As a user, you do not need to do anything for this to happen.</p> <p>However, should you wish to install WAVI into different environments, please refer to the advanced usage page for guidance on how to do this.</p>"},{"location":"license/","title":"LICENSE","text":"<p>MIT License</p> <p>Copyright (c) 2021-2025 Alex Bradley</p> <p>Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the \"Software\"), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:</p> <p>The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.</p> <p>THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.</p>"},{"location":"platforms/","title":"Platforms","text":"<p>WAVIhpc contains templates for the following platforms: ARCHER2, BAS HPC and JASMIN. But which one should you use?</p> <p>This page aims to give a high-level comparison and quickstart guide to each platform.</p>"},{"location":"platforms/#comparison","title":"Comparison","text":"<p>Below is a comparison table of usage and hardware specification of the different supported platforms. Number of nodes/cores are not exact, but are intended to be indicative.</p> Feature ARCHER2 JASMIN BAS HPC Purpose National HPC service for compute-intensive research Data-intensive computing for climate/environmental science BAS's internal HPC cluster Permitted Use ESPRC + NERC NERC BAS internal only CPU AMD EPYC 7742, 64-core Zen 2 processors Various Intel Xeon CPUs Various Intel Xeon CPUs Number of Nodes ~5860 total ~300 total ~20 total Number of Cores ~750,000 total ~19,000 total ~ 430 total Memory per Node 256 GB to 512 GB (standard nodes) 256 GB to 1024 GB (depending on host group) 512 GB"},{"location":"platforms/#archer2","title":"ARCHER2","text":"<p>ARCHER2 is the National HPC service for compute-intensive research for ESPRC + NERC funded research. You can read more about its storage types and hardware specifications.</p> <p>ARCHER2 is the most powerful HPC supported by WAVIhpc, and therefore well-suited to the most compute-intensive ensembles.</p> <p>Recommended reading:</p> <ol> <li>Quickstart for users.</li> <li>Running jobs.</li> <li>Data Management &amp; Transfer.</li> </ol>"},{"location":"platforms/#bas-hpc","title":"BAS HPC","text":"<p>The BAS HPC is BAS's internal HPC cluster. You can read more about the hardware specifications (BAS internal only).</p> <p>While not as powerful as ARCHER2, this cluster is only open to other BAS users. It is well suited for day-to-day running and testing of ensembles, and internal use.</p> <p>Recommended reading:</p> <ol> <li>HPC User Guide.</li> <li>HPC Training.</li> <li>Linux Service Desk Solutions.</li> </ol>"},{"location":"platforms/#jasmin","title":"JASMIN","text":"<p>JASMIN is a data analysis facility for NERC funded research or related environmental science projects. It provides storage and compute. You can read more about its storage types, and hardware specifications.</p> <p>JASMIN provides larger and more versatile storage, but ARCHER2 is a far more powerful computing facility. It is well suited for day-to-day running and testing of ensembles, high-memory runs or simply testing your ensembles on a different platform.</p> <p>Recommended reading:</p> <ol> <li>Getting started.</li> <li>Batch computing.</li> <li>Introduction to group workspaces.</li> </ol>"},{"location":"platforms/#run-on-archer2-store-on-jasmin","title":"Run on ARCHER2, store on JASMIN","text":"<p>As you have read above, ARCHER2's compute is more powerful while JASMIN's storage is more versatile - you can choose to combine these, by following the Transfers from ARCHER2 documentation.</p>"},{"location":"templates_cases/","title":"Templates &amp; Cases","text":"<p>Below is a breakdown of the different templates and use cases that are provided in WAVIhpc.</p>"},{"location":"templates_cases/#platform-templates","title":"Platform Templates","text":"<p>Not sure which platform to use? See the section on platforms.</p>"},{"location":"templates_cases/#template","title":"template","text":"<p>The <code>template</code> case is the boilerplate template on which all other templates are based.</p> <p>It contains the following structure:</p> <pre><code>cases\n\u2514\u2500\u2500 template\n    \u251c\u2500\u2500 code\n    \u251c\u2500\u2500 ensemble\n    |   \u2514\u2500\u2500 template.yaml\n    \u251c\u2500\u2500 input\n    |   \u251c\u2500\u2500 drive.jl\n    |   \u2514\u2500\u2500 driver.jl.j2\n    \u251c\u2500\u2500 run\n    \u2514\u2500\u2500 scripts\n        \u251c\u2500\u2500 prep_run\n        \u251c\u2500\u2500 run_driver\n        \u251c\u2500\u2500 run_ensemble_member\n        \u2514\u2500\u2500 run_ensemble_member.j2\n</code></pre> <p>All other cases also follow this structure. The directories contain the following:</p> <ul> <li><code>/code</code>: Empty in templates, but could contain additional (e.g. Julia) code required to run your ensemble.</li> <li><code>/ensemble</code>: Contains a model-ensembler configuration file, <code>template.yaml</code>.</li> <li><code>/input</code>: Contains input files, in this case <code>driver.jl</code>/<code>driver.jl.j2</code>, files which instantiate, configure and run the WAVI simulation. Also see WAVI API Overview.</li> <li><code>/run</code>: An empty folder, which will contain output files for each run.</li> <li><code>/scripts</code>: Contains scripts <code>prep_run</code>, <code>run_driver.jl</code>, <code>run_ensemble_member</code>/<code>run_ensemble_member.j2</code>, whose execution are configured by <code>/ensemble/template.yaml</code></li> </ul>"},{"location":"templates_cases/#template_bas","title":"template_bas","text":"<p>The BAS template structure is identical to the boilerplate template, but there are changes to <code>ensemble/template.yaml</code> and <code>scripts/run_ensemble_member</code> tailored to running on the BAS HPC.</p> <p>(BAS internal only) See the HPC training guides on Slurm scheduling and Slurm Advanced for more information on the BAS HPC cluster, node choices and sbatch header options.</p>"},{"location":"templates_cases/#template_archer","title":"template_archer","text":"<p>The ARCHER2 template structure is identical to the boilerplate template, but there are changes to <code>ensemble/template.yaml</code> and <code>scripts/run_ensemble_member</code> tailored to running on the ARCHER2 cluster.</p> <p>See ARCHER2's running jobs documentation for more information on ARCHER2's cluster, node choices and sbatch header options.</p>"},{"location":"templates_cases/#template_jasmin","title":"template_jasmin","text":"<p>Identical to ARCHER2, with JASMIN-specific changes to <code>ensemble/template.yaml</code> and <code>script/run_ensemble_member</code>.</p> <p>See JASMIN's batch computing documentation for more information on JASMIN's cluster, node choices and sbatch header options. </p>"},{"location":"templates_cases/#use-case-templates","title":"Use Case Templates","text":""},{"location":"templates_cases/#attr_666","title":"ATTR_666","text":""},{"location":"templates_cases/#mismip_666","title":"MISMIP_666","text":"<p>This case is intended to simulate the Marine Ice Sheet Model Intercomparison, which you can also follow in the WAVI documentation.</p> <p>Configured to run on ARCHER2, MISMIP_666 contains changes to <code>input/driver.jl</code>, as well as additional files under <code>/scripts</code>: <code>prep_run.sh</code>, <code>rsync_jld2.sh</code>, <code>rsync_mat.sh</code>, <code>rsync.sh</code>, <code>run_repeat.sh</code> and <code>sub_run.sh</code>.</p>"},{"location":"templates_cases/#misomip_666","title":"MISOMIP_666","text":"<p>This case is intended to simulate the Marine Ice Sheet-Ocean Model Intercomparison Project (MISOMIP)</p> <p>Configured to run on ARCHER2, MISOMIP_666 contains changes to <code>input/driver.jl</code>, as well as additional input data files: <code>bathyREAL_408.box</code>, <code>hinit400_40_24_2.box</code>, <code>hmask400_40_24_2_edit.bin</code>, and <code>Streamice_Thickness_out.data</code>.</p> <p>It also contains additional files under <code>/scripts</code>: <code>prep_run.sh</code>, <code>rsync.sh</code>, <code>run_repeat.sh</code> and <code>sub_run.sh</code>.</p>"},{"location":"troubleshooting/","title":"Troubleshooting","text":"<p>Below is information on where to find logs for debugging, and other common issues you may run into.</p>"},{"location":"troubleshooting/#logs","title":"Logs","text":"<p>Output logs will be written to the root of your ensemble run folders (e.g. <code>test_ensemble-*</code>).</p> <p>You will also find a run log under <code>/run/proc.0.log</code>.</p>"},{"location":"troubleshooting/#cant-find-command-wavi_install","title":"Can't find command <code>wavi_install</code>","text":"<p>Make sure you have set <code>export PATH=\"</code>realpath .<code>/scripts/local:$PATH\"</code> in the root directory of  WAVIhpc. Replace <code>local</code> with the name of the platform you are running on.</p>"},{"location":"troubleshooting/#wavi_install-cant-find-julia","title":"<code>wavi_install</code> can't find Julia","text":"<p>Make sure you have either loaded the Julia module:</p> <pre><code>module avail julia\nmodule load julia-*\n</code></pre> <p>Or, if you have installed Julia using <code>install_julia.sh</code>, point to it in <code>PATH</code>: <pre><code>export PATH=\"$PATH:/path/to/&lt;Julia directory&gt;/bin\"\n</code></pre></p>"},{"location":"troubleshooting/#hpc-nodes-cant-find-julia","title":"HPC Nodes can't find Julia","text":"<p>Inspect <code>/scripts/run_ensemble_member.j2</code> - is the script loading a Julia module, or pointing to the right location in <code>PATH</code>?</p>"},{"location":"troubleshooting/#hpc-nodes-cant-find-wavi","title":"HPC Nodes can't find WAVI","text":"<p>Did you call <code>wavi_install</code> before submitting the job?</p> <p>If you are not sure if WAVI is installed in the right place, you can check so interactively. In Julia:</p> <pre><code>import Pkg\nPkd.add(\"WAVI\")\n\nusing WAVI\n</code></pre> <p>If you have installed WAVI, but julia cannot find it - check your <code>JULIA_DEPOT_PATH</code>.</p>"},{"location":"troubleshooting/#cant-find-command-module","title":"Can't find command <code>module</code>","text":"<p>Try running: <pre><code>source /etc/profile.d/modules.sh\n</code></pre></p> <p>To prevent this issue in the future, consider adding this to <code>~/.bashrc</code>.</p>"},{"location":"troubleshooting/#post-run-check-fails-there-is-no-outfilenc","title":"Post-run check fails: there is no <code>outfile.nc</code>","text":"<p>In <code>ensemble/template.yaml</code>: <pre><code>      post_run:\n        - name:     check\n          args:\n            cmd:    /usr/bin/test -f run/outfile.nc\n            fail:   True\n        - name:     move\n          args:\n            dest:   \"/data/hpcdata/users/${USER}/WAVIhpc\"\n</code></pre></p> <p>Is <code>dest:</code> pointing to a destination that the HPC nodes can see, and that the user has write-access to?</p>"},{"location":"troubleshooting/#bas-hpc-quota-exceeded","title":"BAS HPC Quota exceeded","text":"<p><code>quota of x exceeds y</code></p> <p>Check the quota you have on the BAS HPC using <code>myquotas</code>, in particular under <code>/data/hpcdata</code> (or wherever you are outputting results). Open an IT ticket to increase your quota, and adjust the limit accordingly in your <code>template.yaml</code>.</p>"},{"location":"troubleshooting/#juliaup-cant-find-the-right-channel","title":"<code>juliaup</code> can't find the right channel","text":"<p>Run <code>juliaup status</code>, is a default channel set?</p> <p>If not:</p> <pre><code>juliaup add release\njuliaup default release\n</code></pre> <p>If this does not resolve the issue, you may be attempting to run julia in an environment with multiple source of julia installation. Try replacing calls of <code>julia</code> in your scripts with the exact julia executable provided by juliaup: <code>/data/hpcdata/users/$USER/.juliaup/bin/julia</code>.</p>"},{"location":"usage/","title":"Usage","text":""},{"location":"usage/#create-an-ensemble-configuration","title":"Create an ensemble configuration","text":"<p>You can use <code>wavi_create_case</code> to create a new template folder to create your ensemble:</p> <p><pre><code>wavi_create_case anewcase template_bas\n</code></pre> This will create a <code>/cases/anewcase</code> folder containing <code>/code</code>, <code>/ensemble</code>, <code>/input</code>, <code>/run</code> and <code>/scripts</code>, based on the <code>/cases/template_bas</code> folder. </p> <p>A full breakdown is provided on the Tempaltes &amp; Cases page, but in first instance pay attention to the following:</p> <ol> <li><code>/ensemble/template.yaml</code> controls the model ensemble, output file directory destinations and the storage quota. Change these as you see fit, ensuring they point to a location which is visible for the HPC nodes. Also see model-ensembler building configuration for a breakdown of different configuration options.</li> <li><code>/scripts/run_ensemble_member.j2</code> is the template for the script that will be sent to SLURM. Pay attention to Julia module loading (if you are loading Julia as a module) or exports to <code>$PATH</code> (if you have installed Julia manually). If you have installed Julia using <code>juliaup</code> (e.g. for Archer/JASMIN/local), you should not need to make any changes here.</li> </ol>"},{"location":"usage/#running-the-ensemble","title":"Running the ensemble","text":"<p>Finally, to run your ensemble:</p> <pre><code>wavi_ensemble test_ensemble anewcase\n</code></pre>"},{"location":"usage/#single-execution","title":"Single execution","text":"<p>You can also try running WAVI in single execution mode:</p> <pre><code>wavi_execute test_run wavi_test\n</code></pre>"},{"location":"developer/contributing/","title":"Contributing to model-ensembler","text":"<p>Contributions are welcome, and they are greatly appreciated! Every little bit helps, and credit will always be given.</p>"},{"location":"developer/contributing/#types-of-contributions","title":"Types of Contributions","text":"<p>You can contribute in many ways:</p>"},{"location":"developer/contributing/#open-an-issue","title":"Open an Issue","text":"<p>Open an issue on Github.</p> <p>If you are reporting a bug, please include:</p> <ul> <li>Your operating system name and version.</li> <li>Any details about your local setup, or HPC platform that might be helpful in troubleshooting.</li> <li>Detailed steps to reproduce the bug.</li> </ul>"},{"location":"developer/contributing/#implement-features","title":"Implement Features","text":"<p>Look through the GitHub issues for features. Anything tagged with \"enhancement\" and \"help wanted\" is open to whoever wants to implement it.</p>"},{"location":"developer/contributing/#write-documentation","title":"Write Documentation","text":"<p>The <code>WAVIhpc</code> documentation can always be improved, please feel encouraged to use the \"edit this page on Github\" feature.</p>"},{"location":"developer/contributing/#add-new-cases","title":"Add new cases","text":"<p>Adding further test cases, in addition to MISMIP, MISOMIP etc. would be very welcome, and enable others to easily run your WAVI ensembling scenarios.</p>"},{"location":"developer/contributing/#adding-new-platforms","title":"Adding new platforms","text":"<p>Contributing to <code>scripts/</code> to enable the templating of cases and running of ensembles on additional HPC clusters would be very welcome. Ideally, stay consistent with the symlinking approach from local to minimise the maintenance effort of supporting different platforms.</p>"},{"location":"developer/contributing/#submit-feedback","title":"Submit Feedback","text":"<p>The best way to send feedback is to open an issue.</p> <p>If you are proposing a feature:</p> <ul> <li>Explain in detail how it would work.</li> <li>Keep the scope as narrow as possible, to make it easier to implement.</li> <li>Remember that this is a volunteer-driven project, and that contributions   are welcome.</li> </ul>"},{"location":"developer/documentation/","title":"Documentation Guide","text":"<p>The documentation is built using mkdocs.</p>"},{"location":"developer/documentation/#installing-dependencies","title":"Installing Dependencies","text":"<p>To install the documentation dependencies:</p> <pre><code>source venv/bin/activate\n\npip install -r docs/requirements.txt\n</code></pre>"},{"location":"developer/documentation/#building-the-docs","title":"Building the Docs","text":"<p>To preview the documentation locally: <pre><code>mkdocs serve\n</code></pre></p> <p>To build the documentation: <pre><code>mkdocs build\n</code></pre></p>"},{"location":"developer/scripts/","title":"Scripts","text":"<p>The scripts folder contains helper functions to help install and initiate WAVI ensembles:</p> <pre><code>scripts\n\u2514\u2500\u2500 archer/jasmin\n|   \u251c\u2500\u2500 fcopy_wavi_case_a2.sh # Unique to ARCHER2\n|   \u251c\u2500\u2500 .. # Symlinks to BAS pre_run.sh and post_batch.sh\n|   \u2514\u2500\u2500 .. # Symlinks to local\n\u2514\u2500\u2500 jasmin\n|   \u251c\u2500\u2500 .. # Symlinks to BAS pre_run.sh and post_batch.sh\n|   \u2514\u2500\u2500 .. # Symlinks to local\n\u2514\u2500\u2500 BAS\n|   \u251c\u2500\u2500 install_julia.sh # Unique to BAS HPC\n|   \u251c\u2500\u2500 post_batch.sh\n|   \u251c\u2500\u2500 pre_run.sh\n|   \u2514\u2500\u2500 .. # Symlinks to local\n\u2514\u2500\u2500 local\n|   \u251c\u2500\u2500 wavi_create_case\n|   \u251c\u2500\u2500 wavi_ensemble\n|   \u251c\u2500\u2500 wavi_execute\n|   \u2514\u2500\u2500 wavi_install\n\u2514\u2500\u2500 common.sh\n\u2514\u2500\u2500 julia_install_wavi.jl\n</code></pre> <p>It contains common scripts used on all platforms, <code>local/</code> scripts which contain the helper functions.</p> <p>The <code>BAS/</code> folder contains symlinks to the helper functions in <code>local/</code>, and additional BAS HPC-specific scripts.</p> <p>The <code>archer/</code> and <code>jasmin/</code> folders contains symlinks to <code>local/</code> and <code>BAS/</code>.</p>"},{"location":"developer/scripts/#_1","title":"./","text":""},{"location":"developer/scripts/#commonsh","title":"<code>common.sh</code>","text":"<p>Checks if Julia is available, and if we are running in the root directory.</p>"},{"location":"developer/scripts/#julia_install_wavijl","title":"<code>julia_install_wavi.jl</code>","text":"<p>Install WAVI into a Pkg environment. Also provides the option to install a development branch of WAVI.</p>"},{"location":"developer/scripts/#local","title":"local","text":"<p>Contains all functionality command scripts, which are described on the functionality page.</p>"},{"location":"developer/scripts/#bas","title":"BAS","text":""},{"location":"developer/scripts/#pre_runsh","title":"<code>pre_run.sh</code>","text":"<p>This is template script to demonstrate a pre-run task as part of an ensemble. </p> <p>It sets environmental variables (such as run destination, outfiles names) used by a run.</p>"},{"location":"developer/scripts/#post_batchsh","title":"<code>post_batch.sh</code>","text":"<p>This is template script to demonstrate a post-batch task as part of an ensemble. </p> <p>It checks whether an outfile exists in the run directory.</p>"},{"location":"developer/scripts/#install_juliash","title":"<code>install_julia.sh</code>","text":"<p>A helper script that installs Julia, specifically written for use on Archer.</p>"},{"location":"developer/scripts/#jasmin","title":"jasmin","text":"<p>Simply contains symlinks to all local scripts, and BAS HPCs <code>pre_run.sh</code> and <code>post_batch.sh</code> </p>"},{"location":"developer/scripts/#archer","title":"archer","text":"<p>As with JASMIN, but with the addition of <code>fcopy_wavi_case_a2.sh</code>.</p>"},{"location":"developer/scripts/#fcopy_wavi_case_a2sh","title":"<code>fcopy_wavi_case_a2.sh</code>","text":"<p>An ARCHER2-specific script wich makes a new case by copying an old case on ARCHER2 without copying results files or unnecessary binaries.</p>"}]}